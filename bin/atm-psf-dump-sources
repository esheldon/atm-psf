#!/usr/bin/env python


def main(flist, outfile, airmass_max):
    import atm_psf
    import fitsio

    data = atm_psf.io.load_sources_many(flist, airmass_max=airmass_max)
    print('writing:', outfile)
    fitsio.write(outfile, data, clobber=True)


def get_args():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('-i', '--input', nargs='+', required=True)
    parser.add_argument('-o', '--output', required=True)
    parser.add_argument('--airmass-max', type=float)
    return parser.parse_args()


if __name__ == '__main__':
    args = get_args()
    main(
        flist=args.input,
        outfile=args.output,
        airmass_max=args.airmass_max,
    )
