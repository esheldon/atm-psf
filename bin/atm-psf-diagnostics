#!/usr/bin/env python


def main(flist, outfile, nbin, frac):
    import atm_psf
    import esutil as eu

    data = atm_psf.io.load_sources_many(flist)
    fig, axs = atm_psf.diagnostics.plot_stars(data, nbin=nbin, frac=frac)

    print('writing:', outfile)
    eu.ostools.makedirs_fromfile(outfile)
    fig.savefig(outfile, dpi=150)


def get_args():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('-i', '--input', nargs='+', required=True)
    parser.add_argument('-o', '--output', required=True)
    parser.add_argument('--nbin', default=30, type=int)
    parser.add_argument(
        '--frac',
        type=float,
        help='use this fraction of objects in scatter plots'
    )
    return parser.parse_args()


if __name__ == '__main__':
    args = get_args()
    main(flist=args.input, outfile=args.output, nbin=args.nbin, frac=args.frac)
