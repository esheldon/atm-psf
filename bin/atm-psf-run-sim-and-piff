#!/usr/bin/env python

from atm_psf.process import run_sim_and_piff
from atm_psf.io import load_config


def get_args():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('--run-config', required=True)
    parser.add_argument('--imsim-config', required=True)
    parser.add_argument('--opsim-db', required=True)
    parser.add_argument('--obsid', type=int, required=True)
    parser.add_argument('--instcat', required=True)
    parser.add_argument('--ccds', required=True,
                        help='e.g. "[35,66]"')
    parser.add_argument('--seed', type=int, required=True)
    parser.add_argument('--nocleanup', action='store_true')
    parser.add_argument('--show', action='store_true')
    parser.add_argument('--no-find-sky', action='store_true',
                        help='just use the sky from the truth catalog')
    return parser.parse_args()


if __name__ == '__main__':
    args = get_args()

    run_config = load_config(args.run_config)
    cleanup = not args.nocleanup

    run_sim_and_piff(
        run_config=run_config,
        imsim_config=args.imsim_config,
        opsim_db=args.opsim_db,
        obsid=args.obsid,
        instcat=args.instcat,
        ccds=args.ccds,
        seed=args.seed,
        cleanup=cleanup,
        show=args.show,
        no_find_sky=args.no_find_sky
    )
